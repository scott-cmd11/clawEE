openapi: 3.1.0
info:
  title: Claw-EE Control API
  version: 0.1.0
  description: >
    Security-first control-plane API for Claw-EE. Includes budget, approval,
    audit, policy reload, channel operations, and attestation endpoints.
servers:
  - url: http://localhost:8080
security:
  - bearerAuth: []
paths:
  /_clawee/control/status:
    get:
      summary: Get control-plane status
      responses:
        "200":
          description: Status payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ControlStatus"
  /_clawee/control/metrics:
    get:
      summary: Get runtime metrics
      responses:
        "200":
          description: Metrics payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ControlMetrics"
  /_clawee/control/suspend:
    post:
      summary: Suspend forwarding
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          $ref: "#/components/responses/OkStatus"
  /_clawee/control/resume:
    post:
      summary: Resume forwarding
      responses:
        "200":
          $ref: "#/components/responses/OkStatus"
  /_clawee/control/approvals/pending:
    get:
      summary: List pending approvals
      responses:
        "200":
          description: Pending approvals
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  approvals:
                    type: array
                    items:
                      $ref: "#/components/schemas/ApprovalRecord"
  /_clawee/control/approvals/{id}/approve:
    post:
      summary: Approve pending high-risk action
      parameters:
        - $ref: "#/components/parameters/ApprovalId"
      responses:
        "200":
          description: Approval fully satisfied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApprovalActionResponse"
        "202":
          description: Partial approval accepted, quorum not yet met
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApprovalActionResponse"
  /_clawee/control/approvals/{id}/deny:
    post:
      summary: Deny pending high-risk action
      parameters:
        - $ref: "#/components/parameters/ApprovalId"
      responses:
        "200":
          description: Approval denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  approval:
                    $ref: "#/components/schemas/ApprovalRecord"
  /_clawee/control/audit/recent:
    get:
      summary: List recent audit ledger events
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        "200":
          description: Recent audit events
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  events:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
  /_clawee/control/audit/verify:
    get:
      summary: Verify hash-chain integrity of audit ledger
      responses:
        "200":
          description: Audit ledger integrity verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuditVerifyResponse"
        "409":
          description: Audit ledger integrity failure detected
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuditVerifyResponse"
  /_clawee/control/audit/attestation:
    get:
      summary: Generate audit attestation payload
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: since
          in: query
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: Audit attestation payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuditAttestationPayload"
  /_clawee/control/audit/attestation/export:
    post:
      summary: Export sealed audit attestation snapshot
      responses:
        "200":
          description: Export metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  snapshot_path:
                    type: string
                  chain_path:
                    type: string
                  count:
                    type: integer
                  final_hash:
                    type: string
  /_clawee/control/audit/attestation/verify:
    post:
      summary: Verify audit snapshot and optional chain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [snapshot_path]
              properties:
                snapshot_path:
                  type: string
                chain_path:
                  type: string
      responses:
        "200":
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  snapshot:
                    type: object
                    additionalProperties: true
                  chain:
                    type: object
                    nullable: true
                    additionalProperties: true
        "409":
          description: Verification failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  snapshot:
                    type: object
                    additionalProperties: true
                  chain:
                    type: object
                    nullable: true
                    additionalProperties: true
  /_clawee/control/security/invariants:
    get:
      summary: Get runtime security invariants status
      responses:
        "200":
          description: Invariant status
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/security/conformance/export:
    post:
      summary: Export signed security conformance snapshot + chain entry
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                report_path:
                  type: string
                chain_path:
                  type: string
      responses:
        "200":
          description: Export result
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/security/conformance/verify:
    post:
      summary: Verify signed security conformance report and optional chain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [report_path]
              properties:
                report_path:
                  type: string
                chain_path:
                  type: string
      responses:
        "200":
          description: Verification success
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "409":
          description: Verification failure
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/approvals/attestation:
    get:
      summary: Generate approval attestation payload
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: since
          in: query
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: Attestation payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApprovalAttestationPayload"
  /_clawee/control/approvals/attestation/export:
    post:
      summary: Export sealed approval attestation snapshot
      responses:
        "200":
          description: Export metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  snapshot_path:
                    type: string
                  chain_path:
                    type: string
                  count:
                    type: integer
                  final_hash:
                    type: string
  /_clawee/control/approvals/attestation/verify:
    post:
      summary: Verify snapshot and optional chain
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [snapshot_path]
              properties:
                snapshot_path:
                  type: string
                chain_path:
                  type: string
      responses:
        "200":
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  snapshot:
                    type: object
                    additionalProperties: true
                  chain:
                    type: object
                    nullable: true
                    additionalProperties: true
  /_clawee/control/channel/send:
    post:
      summary: Queue outbound channel message
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel, destination, text]
              properties:
                channel:
                  type: string
                  enum: [slack, teams, discord, email, webhook]
                destination:
                  type: string
                text:
                  type: string
                metadata:
                  type: object
                  additionalProperties: true
      responses:
        "200":
          description: Message queued
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    $ref: "#/components/schemas/ChannelMessage"
  /_clawee/control/channel/delivery:
    get:
      summary: List outbound delivery status
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        "200":
          description: Delivery rows
          content:
            application/json:
              schema:
                type: object
                properties:
                  deliveries:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
  /_clawee/control/channel/delivery/{id}/retry:
    post:
      summary: Force retry of failed/pending delivery
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Retry accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
  /_clawee/control/vdi/session/start:
    post:
      summary: Start a VDI browser session
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VdiSessionStartRequest"
      responses:
        "200":
          description: Session started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VdiSessionResponse"
        "503":
          description: VDI runtime disabled
  /_clawee/control/vdi/session/{id}/step:
    post:
      summary: Execute one browser step in a VDI session
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VdiStepRequest"
      responses:
        "200":
          description: Step executed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VdiStepResponse"
        "403":
          description: Step blocked by VDI allowlist policy
        "503":
          description: VDI runtime disabled
  /_clawee/control/vdi/session/{id}/stop:
    post:
      summary: Stop a VDI browser session
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session stopped
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VdiSessionResponse"
        "503":
          description: VDI runtime disabled
  /_clawee/control/vdi/session/{id}:
    get:
      summary: Get VDI session state
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VdiSessionResponse"
        "503":
          description: VDI runtime disabled
  /_clawee/control/vdi/session/{id}/artifacts:
    get:
      summary: List VDI session artifacts
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Artifact list
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  artifacts:
                    type: array
                    items:
                      type: string
        "503":
          description: VDI runtime disabled
  /_clawee/control/initiatives:
    get:
      summary: List initiatives
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, running, paused, completed, cancelled, failed]
        - name: source
          in: query
          schema:
            type: string
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, normal, high, urgent]
      responses:
        "200":
          description: Initiative list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  initiatives:
                    type: array
                    items:
                      $ref: "#/components/schemas/InitiativeRecord"
    post:
      summary: Create an initiative
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InitiativeCreateRequest"
      responses:
        "200":
          description: Existing initiative returned (deduped)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeCreateResponse"
        "201":
          description: Initiative created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeCreateResponse"
  /_clawee/control/initiatives/{id}/tasks:
    get:
      summary: List tasks for an initiative
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
      responses:
        "200":
          description: Initiative task list
          content:
            application/json:
              schema:
                type: object
                properties:
                  initiative:
                    $ref: "#/components/schemas/InitiativeRecord"
                  count:
                    type: integer
                  tasks:
                    type: array
                    items:
                      $ref: "#/components/schemas/InitiativeTaskRecord"
        "404":
          description: Initiative not found
  /_clawee/control/initiatives/{id}/events:
    get:
      summary: List initiative events (latest first)
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
      responses:
        "200":
          description: Initiative event list
          content:
            application/json:
              schema:
                type: object
                properties:
                  initiative:
                    $ref: "#/components/schemas/InitiativeRecord"
                  count:
                    type: integer
                  events:
                    type: array
                    items:
                      $ref: "#/components/schemas/InitiativeEventRecord"
        "404":
          description: Initiative not found
  /_clawee/control/initiatives/{id}/start:
    post:
      summary: Start an initiative
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
      responses:
        "200":
          description: Initiative started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeStatusResponse"
        "404":
          description: Initiative not found
  /_clawee/control/initiatives/{id}/pause:
    post:
      summary: Pause an initiative
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          description: Initiative paused
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeStatusResponse"
        "404":
          description: Initiative not found
  /_clawee/control/initiatives/{id}/cancel:
    post:
      summary: Cancel an initiative
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          description: Initiative cancelled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeStatusResponse"
        "404":
          description: Initiative not found
  /_clawee/control/initiatives/{id}/interrupt:
    post:
      summary: Interrupt an initiative (pauses active work)
      parameters:
        - $ref: "#/components/parameters/InitiativeId"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          description: Initiative interrupted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeStatusResponse"
        "404":
          description: Initiative not found
  /_clawee/control/reload/policies:
    post:
      summary: Reload policy catalog
      responses:
        "200":
          $ref: "#/components/responses/FingerprintOk"
  /_clawee/control/reload/approval-policy:
    post:
      summary: Reload approval-policy catalog
      responses:
        "200":
          $ref: "#/components/responses/FingerprintOk"
  /_clawee/control/reload/capability-policy:
    post:
      summary: Reload capability policy catalog
      responses:
        "200":
          $ref: "#/components/responses/FingerprintOk"
  /_clawee/control/reload/model-registry:
    post:
      summary: Reload model registry
      responses:
        "200":
          $ref: "#/components/responses/FingerprintOk"
  /_clawee/control/reload/control-tokens:
    post:
      summary: Reload control RBAC token catalog
      responses:
        "200":
          description: Reloaded token catalog state
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/reload/channel-destination-policy:
    post:
      summary: Reload channel destination policy
      responses:
        "200":
          description: Destination policy state
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/reload/approval-attestation-signing:
    post:
      summary: Reload approval attestation signing keys
      responses:
        "200":
          description: Signing state
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/reload/audit-attestation-signing:
    post:
      summary: Reload audit attestation signing keys
      responses:
        "200":
          description: Signing state
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/reload/security-conformance-signing:
    post:
      summary: Reload security conformance signing keys
      responses:
        "200":
          description: Signing state
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /_clawee/control/modality/ingest:
    post:
      summary: Ingest validated modality observation (control plane)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModalityIngestRequest"
      responses:
        "200":
          description: Observation ingested
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          description: Schema validation failed
        "413":
          description: Payload size limit exceeded
  /_clawee/intake/{provider}/webhook:
    post:
      summary: Ingest provider webhook and create/start initiative
      security:
        - intakeTokenHeader: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [jira, linear, pagerduty]
        - name: x-intake-signature
          in: header
          required: false
          schema:
            type: string
        - name: x-intake-timestamp
          in: header
          required: false
          schema:
            type: string
        - name: x-intake-event-id
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InitiativeIntakeRequest"
      responses:
        "200":
          description: Initiative deduped/existing
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeIntakeResponse"
        "201":
          description: Initiative created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitiativeIntakeResponse"
        "400":
          description: Invalid provider payload
        "401":
          description: Intake auth/signature failed
        "409":
          description: Replay detected
        "503":
          description: Initiative engine disabled
  /_clawee/intake/openclaw/work-item:
    post:
      summary: Ingest OpenClaw work-item and create/start initiative
      security:
        - openclawTokenHeader: []
      parameters:
        - name: x-openclaw-signature
          in: header
          required: false
          schema:
            type: string
        - name: x-openclaw-timestamp
          in: header
          required: false
          schema:
            type: string
        - name: x-openclaw-event-id
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OpenClawWorkItemRequest"
      responses:
        "200":
          description: Initiative deduped/existing
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OpenClawWorkItemResponse"
        "201":
          description: Initiative created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OpenClawWorkItemResponse"
        "400":
          description: Invalid OpenClaw payload
        "401":
          description: OpenClaw auth/signature failed
        "409":
          description: Replay detected
        "503":
          description: Initiative engine disabled
  /_clawee/intake/openclaw/heartbeat:
    post:
      summary: Ingest OpenClaw heartbeat telemetry
      security:
        - openclawTokenHeader: []
      parameters:
        - name: x-openclaw-signature
          in: header
          required: false
          schema:
            type: string
        - name: x-openclaw-timestamp
          in: header
          required: false
          schema:
            type: string
        - name: x-openclaw-event-id
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OpenClawHeartbeatRequest"
      responses:
        "200":
          description: Heartbeat accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OpenClawHeartbeatResponse"
        "400":
          description: Invalid heartbeat payload
        "401":
          description: OpenClaw auth/signature failed
        "409":
          description: Replay detected
  /_clawee/channel/{channel}/inbound:
    post:
      summary: Ingest inbound channel event (connector)
      security:
        - channelTokenHeader: []
      parameters:
        - name: channel
          in: path
          required: true
          schema:
            type: string
            enum: [slack, teams, discord, email, webhook]
        - name: x-channel-signature
          in: header
          required: false
          schema:
            type: string
        - name: x-channel-timestamp
          in: header
          required: false
          schema:
            type: string
        - name: x-channel-event-id
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [source, sender, text]
              properties:
                source:
                  type: string
                  maxLength: 256
                sender:
                  type: string
                  maxLength: 256
                text:
                  type: string
                  maxLength: 8000
                event_id:
                  type: string
                metadata:
                  type: object
                  additionalProperties: true
      responses:
        "200":
          description: Event ingested
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    channelTokenHeader:
      type: apiKey
      in: header
      name: x-channel-token
    intakeTokenHeader:
      type: apiKey
      in: header
      name: x-intake-token
    openclawTokenHeader:
      type: apiKey
      in: header
      name: x-openclaw-token
  parameters:
    ApprovalId:
      name: id
      in: path
      required: true
      schema:
        type: string
    InitiativeId:
      name: id
      in: path
      required: true
      schema:
        type: string
  responses:
    OkStatus:
      description: Action accepted and status returned
      content:
        application/json:
          schema:
            type: object
            properties:
              ok:
                type: boolean
              status:
                type: object
                additionalProperties: true
    FingerprintOk:
      description: Reload succeeded
      content:
        application/json:
          schema:
            type: object
            properties:
              ok:
                type: boolean
              fingerprint:
                type: string
  schemas:
    InitiativeRecord:
      type: object
      properties:
        id:
          type: string
        source:
          type: string
        external_ref:
          type: string
          nullable: true
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        risk_class:
          type: string
          enum: [low, medium, high, critical]
        status:
          type: string
          enum: [pending, running, paused, completed, cancelled, failed]
        requested_by:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
          nullable: true
        finished_at:
          type: string
          format: date-time
          nullable: true
        last_error:
          type: string
          nullable: true
    InitiativeTaskRecord:
      type: object
      properties:
        id:
          type: string
        initiative_id:
          type: string
        sequence:
          type: integer
        task_type:
          type: string
        payload:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [queued, running, retry, completed, failed, cancelled]
        retry_count:
          type: integer
        max_retries:
          type: integer
        next_run_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
          nullable: true
        finished_at:
          type: string
          format: date-time
          nullable: true
        last_error:
          type: string
          nullable: true
    InitiativeEventRecord:
      type: object
      properties:
        id:
          type: integer
        initiative_id:
          type: string
        task_id:
          type: string
          nullable: true
        event_type:
          type: string
        actor:
          type: string
        payload:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
        previous_hash:
          type: string
        current_hash:
          type: string
    InitiativeStats:
      type: object
      properties:
        enabled:
          type: boolean
        total:
          type: integer
        pending:
          type: integer
        running:
          type: integer
        paused:
          type: integer
        completed:
          type: integer
        cancelled:
          type: integer
        failed:
          type: integer
        task_queued:
          type: integer
        task_running:
          type: integer
        task_retry:
          type: integer
        task_failed:
          type: integer
    InitiativeCreateTaskRequest:
      type: object
      required: [task_type]
      properties:
        task_type:
          type: string
        payload:
          type: object
          additionalProperties: true
        max_retries:
          type: integer
    InitiativeCreateRequest:
      type: object
      required: [source, title]
      properties:
        source:
          type: string
        external_ref:
          type: string
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        risk_class:
          type: string
          enum: [low, medium, high, critical]
        metadata:
          type: object
          additionalProperties: true
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/InitiativeCreateTaskRequest"
    InitiativeCreateResponse:
      type: object
      properties:
        ok:
          type: boolean
        created:
          type: boolean
        initiative:
          $ref: "#/components/schemas/InitiativeRecord"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/InitiativeTaskRecord"
    InitiativeStatusResponse:
      type: object
      properties:
        ok:
          type: boolean
        initiative:
          $ref: "#/components/schemas/InitiativeRecord"
    InitiativeIntakeRequest:
      type: object
      description: Provider-native webhook payload (schema varies by provider).
      additionalProperties: true
    InitiativeIntakeResponse:
      type: object
      properties:
        ok:
          type: boolean
        provider:
          type: string
          enum: [jira, linear, pagerduty]
        event_id:
          type: string
          nullable: true
        created:
          type: boolean
        started:
          type: boolean
        template:
          $ref: "#/components/schemas/InitiativeTemplateSummary"
        initiative:
          $ref: "#/components/schemas/InitiativeRecord"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/InitiativeTaskRecord"
    InitiativeTemplateSummary:
      type: object
      properties:
        template_id:
          type: string
        template_version:
          type: string
        strategy:
          type: string
        task_count:
          type: integer
        stages:
          type: array
          items:
            type: string
    OpenClawWorkItemRequest:
      type: object
      required: [event_id, agent_id, work_type, title]
      properties:
        event_id:
          type: string
        agent_id:
          type: string
        work_type:
          type: string
          enum: [task_assigned, incident_interrupt, message_request, manual_order]
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        risk_class:
          type: string
          enum: [low, medium, high, critical]
        source_ref:
          type: string
        channel:
          type: string
          enum: [slack, teams, discord, email, webhook]
        destination:
          type: string
        text:
          type: string
        metadata:
          type: object
          additionalProperties: true
    OpenClawWorkItemResponse:
      type: object
      properties:
        ok:
          type: boolean
        provider:
          type: string
          enum: [openclaw]
        event_id:
          type: string
          nullable: true
        created:
          type: boolean
        started:
          type: boolean
        adapter:
          type: object
          additionalProperties: true
        normalization:
          type: object
          additionalProperties: true
        template:
          $ref: "#/components/schemas/InitiativeTemplateSummary"
        initiative:
          $ref: "#/components/schemas/InitiativeRecord"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/InitiativeTaskRecord"
    OpenClawHeartbeatRequest:
      type: object
      required: [agent_id]
      properties:
        event_id:
          type: string
        agent_id:
          type: string
        status:
          type: string
        active_task_id:
          type: string
        queue_depth:
          type: integer
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
    OpenClawHeartbeatResponse:
      type: object
      properties:
        ok:
          type: boolean
        provider:
          type: string
          enum: [openclaw]
        event_id:
          type: string
          nullable: true
        adapter:
          type: object
          additionalProperties: true
        heartbeat:
          type: object
          additionalProperties: true
    ModalityIngestRequest:
      oneOf:
        - $ref: "#/components/schemas/ModalityIngestTextRequest"
        - $ref: "#/components/schemas/ModalityIngestVisionRequest"
        - $ref: "#/components/schemas/ModalityIngestAudioRequest"
        - $ref: "#/components/schemas/ModalityIngestActionRequest"
    ModalityIngestTextRequest:
      type: object
      required: [session_id, modality, source, payload]
      properties:
        session_id:
          type: string
          maxLength: 256
        modality:
          type: string
          enum: [text]
        source:
          type: string
          maxLength: 256
        timestamp:
          type: string
          format: date-time
        payload:
          type: object
          required: [text]
          additionalProperties: false
          properties:
            text:
              type: string
            language:
              type: string
              maxLength: 32
            sender:
              type: string
              maxLength: 256
            metadata:
              type: object
              additionalProperties: true
    ModalityIngestVisionRequest:
      type: object
      required: [session_id, modality, source, payload]
      properties:
        session_id:
          type: string
          maxLength: 256
        modality:
          type: string
          enum: [vision]
        source:
          type: string
          maxLength: 256
        timestamp:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: false
          properties:
            image_url:
              type: string
              maxLength: 4096
            image_b64:
              type: string
            ocr_text:
              type: string
            mime_type:
              type: string
            width:
              type: integer
            height:
              type: integer
            metadata:
              type: object
              additionalProperties: true
    ModalityIngestAudioRequest:
      type: object
      required: [session_id, modality, source, payload]
      properties:
        session_id:
          type: string
          maxLength: 256
        modality:
          type: string
          enum: [audio]
        source:
          type: string
          maxLength: 256
        timestamp:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: false
          properties:
            transcript:
              type: string
            audio_url:
              type: string
              maxLength: 4096
            audio_b64:
              type: string
            mime_type:
              type: string
            duration_ms:
              type: integer
            speaker:
              type: string
              maxLength: 256
            metadata:
              type: object
              additionalProperties: true
    ModalityIngestActionRequest:
      type: object
      required: [session_id, modality, source, payload]
      properties:
        session_id:
          type: string
          maxLength: 256
        modality:
          type: string
          enum: [action]
        source:
          type: string
          maxLength: 256
        timestamp:
          type: string
          format: date-time
        payload:
          type: object
          required: [action]
          additionalProperties: false
          properties:
            action:
              type: string
              maxLength: 128
            status:
              type: string
              enum: [queued, running, succeeded, failed]
            target:
              type: string
              maxLength: 512
            arguments:
              type: object
              additionalProperties: true
            result: {}
            error:
              type: string
              maxLength: 4000
            metadata:
              type: object
              additionalProperties: true
    ApprovalRecord:
      type: object
      properties:
        id:
          type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        status:
          type: string
        required_approvals:
          type: integer
        required_roles:
          type: string
        max_uses:
          type: integer
        use_count:
          type: integer
        last_used_at:
          type: string
          nullable: true
        approval_actors:
          type: string
        approval_actor_roles:
          type: string
        request_fingerprint:
          type: string
        reason:
          type: string
    ApprovalActionResponse:
      type: object
      properties:
        ok:
          type: boolean
        pending:
          type: boolean
        approval:
          $ref: "#/components/schemas/ApprovalRecord"
        remaining_approvals:
          type: integer
        missing_required_roles:
          type: array
          items:
            type: string
    ApprovalAttestationPayload:
      type: object
      properties:
        generated_at:
          type: string
          format: date-time
        count:
          type: integer
        final_hash:
          type: string
        signature:
          type: string
          nullable: true
    AuditVerifyResponse:
      type: object
      properties:
        ok:
          type: boolean
        report:
          type: object
          properties:
            valid:
              type: boolean
            total_rows:
              type: integer
            checked_rows:
              type: integer
            first_invalid_id:
              type: integer
              nullable: true
            reason:
              type: string
              nullable: true
            expected_hash:
              type: string
              nullable: true
            actual_hash:
              type: string
              nullable: true
            chain_tip:
              type: string
    AuditAttestationPayload:
      type: object
      properties:
        generated_at:
          type: string
          format: date-time
        since:
          type: string
          nullable: true
        count:
          type: integer
        entries:
          type: array
          items:
            type: object
            additionalProperties: true
        final_hash:
          type: string
        signature:
          type: string
          nullable: true
        signature_kid:
          type: string
          nullable: true
        signature_kid:
          type: string
          nullable: true
        entries:
          type: array
          items:
            type: object
            additionalProperties: true
    ChannelMessage:
      type: object
      properties:
        id:
          type: string
        channel:
          type: string
        destination:
          type: string
        text:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
    VdiSessionStartRequest:
      type: object
      properties:
        label:
          type: string
        start_url:
          type: string
        viewport:
          type: object
          properties:
            width:
              type: integer
            height:
              type: integer
        metadata:
          type: object
          additionalProperties: true
    VdiSessionSummary:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        status:
          type: string
          enum: [active, closed]
        started_at:
          type: string
          format: date-time
        stopped_at:
          type: string
          format: date-time
          nullable: true
        current_url:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true
    VdiStepRequest:
      type: object
      required: [action]
      properties:
        action:
          type: string
          enum: [navigate, click, type, select, wait_for, screenshot, extract_text]
        url:
          type: string
        selector:
          type: string
        text:
          type: string
        value:
          oneOf:
            - type: string
            - type: array
              items:
                type: string
        timeout_ms:
          type: integer
        full_page:
          type: boolean
        metadata:
          type: object
          additionalProperties: true
    VdiStepResult:
      type: object
      properties:
        action:
          type: string
        ok:
          type: boolean
        timestamp:
          type: string
          format: date-time
        current_url:
          type: string
          nullable: true
        text:
          type: string
          nullable: true
        screenshot_path:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true
    VdiSessionResponse:
      type: object
      properties:
        ok:
          type: boolean
        session:
          $ref: "#/components/schemas/VdiSessionSummary"
    VdiStepResponse:
      type: object
      properties:
        ok:
          type: boolean
        result:
          $ref: "#/components/schemas/VdiStepResult"
    ControlStatus:
      type: object
      properties:
        node_id:
          type: string
        cluster_id:
          type: string
        enforcement_mode:
          type: string
        warn_threshold:
          type: number
        budget:
          type: object
          additionalProperties: true
        control_authz:
          type: object
          additionalProperties: true
        approval_policy:
          type: object
          additionalProperties: true
        capability_policy:
          type: object
          additionalProperties: true
        replay_store:
          type: object
          additionalProperties: true
        initiatives:
          $ref: "#/components/schemas/InitiativeStats"
        vdi_runtime:
          type: object
          additionalProperties: true
        initiative_intake:
          type: object
          additionalProperties: true
        openclaw_adapter:
          type: object
          additionalProperties: true
        config_fingerprints:
          type: object
          additionalProperties:
            type: string
    ControlMetrics:
      type: object
      properties:
        node_id:
          type: string
        cluster_id:
          type: string
        service:
          type: string
        timestamp:
          type: string
          format: date-time
        uptime_seconds:
          type: integer
        budget:
          type: object
          additionalProperties: true
        approvals:
          type: object
          additionalProperties: true
        interactions:
          type: object
          additionalProperties: true
        initiatives:
          $ref: "#/components/schemas/InitiativeStats"
        vdi_runtime:
          type: object
          additionalProperties: true
        initiative_intake:
          type: object
          additionalProperties: true
        openclaw_adapter:
          type: object
          additionalProperties: true
        process:
          type: object
          additionalProperties: true
        config_fingerprints:
          type: object
          additionalProperties:
            type: string
